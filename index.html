<!doctype html>
<html>
    <body style=>
        <iframe id="grg" allow="fullscreen" style="position:fixed;width:100%;height:100%;top:0;left:0;border:none"></iframe> 
        
        <script>
            function openC(url) {
            const win = window.open();
            const iframe = win.document.createElement('iframe');
            iframe.style.width = "100%";
            iframe.style.height = "100%";
            iframe.style.border = "none";
            iframe.src = url
            iframe.style.position = "fixed";
            iframe.style.top = "0";
            iframe.style.left = "0";
            iframe.style.right = "0";
            iframe.style.bottom = "0";
            iframe.allow = 'fullscreen';
            win.document.body.appendChild(iframe);
            };
            const paramsString = window.location.search;
            const URLParams = new URLSearchParams(paramsString);
            
            if (URLParams.has('cloak')) {
                if (URLParams.get('v')) {//not using the .has() method here because URL always gets sent with the ?v= parameter, it is more appropiate here to check if it is not empty.
                    openC('https://dfsg-youtube.vercel.app/' + '?v=' + URLParams.get('v'));
                } else {
                    openC('https://dfsg-youtube.vercel.app/')
                };
                if (window.top == window.self) {
                    window.location.replace('https://google.com')
                } else {
                  window.location.replace('https://dfsg-youtube.vercel.app/');
                };
            } else {
                
                if (URLParams.has('v')) {
                    let a = URLParams.get('v');
                    if (a.startsWith('http://')) {
                        a = a.replace('http://', 'https://');
                    };
                    if (!a.startsWith('https://')) {
                        a = 'https://'+a;
                    };
                    if (a.startsWith('https://youtube.com')) {
                        a = a.replace('https://', 'https://www.')
                    }
                    if (a.startsWith('https://www.youtube.com/embed/')) {
                        a = a.replace('embed/', 'watch?v=');
                    };
       
                    sessionStorage.setItem('url', a);
                    window.location.replace("/");
                } else {
                    if (sessionStorage.getItem('url')) {
                        if (sessionStorage.getItem('url').startsWith('https://www.youtube.com/watch?v=')) {
                            const yturl = new URL(sessionStorage.getItem('url'));
                            const ytURLParams = new URLSearchParams(yturl.search)
                            document.getElementById('grg').src = '/ythandler?v=' + ytURLParams.get('v');
                        } else {
                            document.getElementById('grg').src = sessionStorage.getItem('url');
                        };
                            sessionStorage.removeItem('url');
                    } else {
                        document.getElementById('grg').src = 'https://dfsg-youtube.vercel.app/homepage.html';
    
                    };
                };
                
            };
        </script>
    </body>
</html>
